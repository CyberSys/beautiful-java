#!/bin/bash
set -e
cd "$(dirname "${BASH_SOURCE}")"

[[ "${@}" == *"--javadoc"* ]] && GENERATE_JAVADOC='yes'
[[ "${@}" == *"--format-decompiled"* ]] && FORMAT_DECOMPILED='yes'

for ARG; do
	[[ ! "${ARG}" == '--javadoc' ]] && [[ ! "${ARG}" == '--format-decompiled'  ]] && ARGS+=("${ARG}")
done
set -- "${ARGS[@]}"

#
# Check Zomboid version
#
echo "* Checking Zomboid version..."
. ./scripts/config.sh --clean
echo "* Found version ${VERSION}"

#
# Copy zomboid files
#
echo "* Copying Zomboid files..."
copyfiles

#
# Run IntelliJ decompiler
#
echo "* Decompiling class files..."
decompile

#
# Run BeautifulJava
#
echo
echo "* Fixing symbols..."
beautiful ${@}

#
# Run IntelliJ code formatter
#
echo
echo "* Formatting source files..."
formatter

if ! [ -z "${FORMAT_DECOMPILED}" ]; then
	echo
	echo "* Formatting decompiled files..."
	formatter "${DECOMPDIR}"
fi

#
# Generate Javadoc
#
if ! [ -z "${GENERATE_JAVADOC}" ]; then
	echo
	echo "* Generating Javadoc..."
	javadoc
fi
